{"version":3,"sources":["../../../../lib/dashboard-data.ts","../../../../app/doctor.tsx/__nextjs-internal-proxy.mjs","../../../../app/%28routes%29/doctor/page.tsx"],"sourcesContent":["const API_BASE = \"https://aetab8pjmb.us-east-1.awsapprunner.com/table\"\r\n\r\ntype ApiResponse<T> = {\r\n  data?: T[]\r\n}\r\n\r\ntype ClinicRecord = {\r\n  clinic_id: number\r\n  clinic_name: string\r\n  location: string\r\n  active: boolean\r\n}\r\n\r\ntype DoctorRecord = {\r\n  doctor_id: number\r\n  name: string\r\n  clinic_id: number\r\n  specialty?: string | null\r\n}\r\n\r\ntype AppointmentRecord = {\r\n  appointment_id: number\r\n  patient_id: number\r\n  doctor_id: number\r\n  datetime: string | null\r\n  status: string\r\n}\r\n\r\ntype DiagnosisRecord = {\r\n  diagnosis_id: number\r\n  doctor_id: number\r\n  diagnosis_date: string\r\n}\r\n\r\ntype AiDiagnosticRecord = {\r\n  confidence_score: number | null\r\n  created_at: string | null\r\n}\r\n\r\ntype PatientRecord = {\r\n  patient_id: number\r\n  name: string\r\n  dob?: string | null\r\n}\r\n\r\ntype MedicalHistoryRecord = {\r\n  patient_id: number\r\n  condition: string\r\n  status: string\r\n  severity?: string\r\n  followup_required?: boolean\r\n  diagnosis_date?: string\r\n}\r\n\r\ntype VitalRecord = {\r\n  patient_id: number\r\n  blood_pressure: string | null\r\n  heart_rate: number | null\r\n  temperature: number | null\r\n  respiratory_rate: number | null\r\n  recorded_on: string | null\r\n}\r\n\r\ntype PrescriptionRecord = {\r\n  patient_id: number\r\n  doctor_id: number\r\n  medicine_name: string\r\n  dosage: string | null\r\n  start_date: string | null\r\n  end_date: string | null\r\n  status: string\r\n  issued_on: string | null\r\n}\r\n\r\ntype LabTestRecord = {\r\n  patient_id: number\r\n  test_type: string\r\n  status: string\r\n  result: string\r\n  test_date: string\r\n}\r\n\r\ntype ClinicHelpRecord = {\r\n  clinic_id: number\r\n  issue_description: string\r\n  submitted_by: string\r\n}\r\n\r\ntype BloodTestRecord = {\r\n  patient_id: number\r\n  test_name: string\r\n  result_value: string\r\n  test_date: string\r\n}\r\n\r\ntype DoctorTaskRecord = {\r\n  doctor_id: number\r\n  description: string\r\n  status: string\r\n  due_date: string\r\n}\r\n\r\ntype PatientMessageHubRecord = {\r\n  patient_id: number\r\n  summary: string\r\n  last_updated: string\r\n}\r\n\r\nasync function fetchTable<T>(table: string): Promise<T[]> {\r\n  try {\r\n    const res = await fetch(`${API_BASE}/${table}`, { cache: \"no-store\" })\r\n    if (!res.ok) {\r\n      throw new Error(`Failed to fetch ${table}`)\r\n    }\r\n    const body = (await res.json()) as ApiResponse<T>\r\n    return Array.isArray(body?.data) ? body.data : []\r\n  } catch (error) {\r\n    console.error(`[fetchTable] ${table}`, error)\r\n    return []\r\n  }\r\n}\r\n\r\nconst formatShortDate = (value: Date) =>\r\n  Intl.DateTimeFormat(\"en-US\", { month: \"short\", day: \"numeric\" }).format(value)\r\n\r\nconst formatDateTime = (value: Date) =>\r\n  Intl.DateTimeFormat(\"en-US\", {\r\n    month: \"short\",\r\n    day: \"numeric\",\r\n    hour: \"numeric\",\r\n    minute: \"2-digit\",\r\n  }).format(value)\r\n\r\nconst toDate = (value: string | null | undefined): Date | null => {\r\n  if (!value) return null\r\n  const parsed = new Date(value)\r\n  return Number.isNaN(parsed.getTime()) ? null : parsed\r\n}\r\n\r\nconst ensureTrend = <T extends { date: string }>(\r\n  points: T[],\r\n  fallbackFactory: () => T[],\r\n) => (points.length ? points : fallbackFactory())\r\n\r\nexport type HospitalOption = {\r\n  id: number\r\n  name: string\r\n  city: string\r\n}\r\n\r\ntype TrendPoint<Key extends string> = {\r\n  date: string\r\n} & Record<Key, number>\r\n\r\nexport type AnalystKPIs = {\r\n  diagnosisVolume: TrendPoint<\"volume\">[]\r\n  appointmentVolume: TrendPoint<\"appointments\">[]\r\n  aiAccuracy: TrendPoint<\"accuracy\">[]\r\n  retention: TrendPoint<\"retention\">[]\r\n}\r\n\r\nexport type AnalystSummary = {\r\n  aiAccuracy: number\r\n  retention: number\r\n  diagnosesTotal: number\r\n  appointmentsTotal: number\r\n}\r\n\r\nexport type AnalystDashboardData = {\r\n  hospitals: HospitalOption[]\r\n  kpiMetrics: AnalystKPIs\r\n  summary: AnalystSummary\r\n}\r\n\r\nexport async function getAnalystDashboardData(): Promise<AnalystDashboardData> {\r\n  const [clinics, diagnoses, appointments, aiDiagnostics] = await Promise.all([\r\n    fetchTable<ClinicRecord>(\"clinic_servicehistory\"),\r\n    fetchTable<DiagnosisRecord>(\"diagnosis\"),\r\n    fetchTable<AppointmentRecord>(\"appointments\"),\r\n    fetchTable<AiDiagnosticRecord>(\"ai_diagnostics\"),\r\n  ])\r\n\r\n  const hospitals: HospitalOption[] = (clinics.length ? clinics : []).map((clinic) => ({\r\n    id: clinic.clinic_id,\r\n    name: clinic.clinic_name ?? `Clinic ${clinic.clinic_id}`,\r\n    city: clinic.location ?? \"Unknown\",\r\n  }))\r\n\r\n  const MAX_POINTS = 180\r\n\r\n  const dailyCount = <Key extends string>(\r\n    records: { date: string | null }[],\r\n    valueKey: Key,\r\n  ): TrendPoint<Key>[] => {\r\n    const map = new Map<string, number>()\r\n    records.forEach((record) => {\r\n      const date = toDate(record.date)\r\n      if (!date) return\r\n      const label = formatShortDate(date)\r\n      map.set(label, (map.get(label) ?? 0) + 1)\r\n    })\r\n    const sorted = Array.from(map.entries()).sort((a, b) => new Date(a[0]).getTime() - new Date(b[0]).getTime())\r\n    const limited = sorted.slice(-MAX_POINTS)\r\n    return limited.map(([date, value]) => ({ date, [valueKey]: value }) as TrendPoint<Key>)\r\n  }\r\n\r\n  const diagnosisVolume = dailyCount(\r\n    diagnoses.map((d) => ({ date: d.diagnosis_date })),\r\n    \"volume\",\r\n  )\r\n\r\n  const appointmentVolume = dailyCount(\r\n    appointments\r\n      .filter((apt) => apt.datetime)\r\n      .map((apt) => ({ date: apt.datetime! })),\r\n    \"appointments\",\r\n  )\r\n\r\n  const aiAccuracy = (() => {\r\n    const map = new Map<string, { sum: number; count: number }>()\r\n    aiDiagnostics.forEach((record) => {\r\n      if (record.confidence_score == null || !record.created_at) return\r\n      const label = formatShortDate(new Date(record.created_at))\r\n      const entry = map.get(label) ?? { sum: 0, count: 0 }\r\n      entry.sum += record.confidence_score * 100\r\n      entry.count += 1\r\n      map.set(label, entry)\r\n    })\r\n    const sorted = Array.from(map.entries()).sort((a, b) => new Date(a[0]).getTime() - new Date(b[0]).getTime())\r\n    const limited = sorted.slice(-MAX_POINTS)\r\n    return limited\r\n      .map(\r\n        ([date, { sum, count }]) =>\r\n          ({\r\n            date,\r\n            accuracy: count ? Number((sum / count).toFixed(1)) : 0,\r\n          }) satisfies TrendPoint<\"accuracy\">,\r\n      )\r\n  })()\r\n\r\n  const retention = (() => {\r\n    const map = new Map<string, { total: number; completed: number }>()\r\n    appointments.forEach((apt) => {\r\n      if (!apt.datetime) return\r\n      const label = formatShortDate(new Date(apt.datetime))\r\n      const entry = map.get(label) ?? { total: 0, completed: 0 }\r\n      entry.total += 1\r\n      if (apt.status?.toLowerCase() === \"completed\") {\r\n        entry.completed += 1\r\n      }\r\n      map.set(label, entry)\r\n    })\r\n    const sorted = Array.from(map.entries()).sort((a, b) => new Date(a[0]).getTime() - new Date(b[0]).getTime())\r\n    const limited = sorted.slice(-MAX_POINTS)\r\n    return limited\r\n      .map(([date, { total, completed }]) => {\r\n        const percent = total ? Number(((completed / total) * 100).toFixed(1)) : 0\r\n        return { date, retention: percent } satisfies TrendPoint<\"retention\">\r\n      })\r\n  })()\r\n\r\n  const fallbackTrend = <Key extends string>(key: Key): TrendPoint<Key>[] =>\r\n    ([\"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\", \"Sun\"] as const).map(\r\n      (day) =>\r\n        ({\r\n          date: day,\r\n          [key]: 1,\r\n        }) as TrendPoint<Key>,\r\n    )\r\n\r\n  const accuracyFallback = () =>\r\n    fallbackTrend(\"accuracy\").map(\r\n      (point) =>\r\n        ({\r\n          ...point,\r\n          accuracy: 90 + point.accuracy,\r\n        }) as TrendPoint<\"accuracy\">,\r\n    )\r\n\r\n  const retentionFallback = () =>\r\n    fallbackTrend(\"retention\").map(\r\n      (point) =>\r\n        ({\r\n          ...point,\r\n          retention: 85 + point.retention,\r\n        }) as TrendPoint<\"retention\">,\r\n    )\r\n\r\n  const kpiMetrics: AnalystKPIs = {\r\n    diagnosisVolume: ensureTrend(diagnosisVolume, () => fallbackTrend(\"volume\")),\r\n    appointmentVolume: ensureTrend(appointmentVolume, () => fallbackTrend(\"appointments\")),\r\n    aiAccuracy: ensureTrend(aiAccuracy, accuracyFallback),\r\n    retention: ensureTrend(retention, retentionFallback),\r\n  }\r\n\r\n  const summary: AnalystSummary = {\r\n    aiAccuracy: kpiMetrics.aiAccuracy.at(-1)?.accuracy ?? 0,\r\n    retention: kpiMetrics.retention.at(-1)?.retention ?? 0,\r\n    diagnosesTotal: kpiMetrics.diagnosisVolume.reduce((sum, point) => sum + point.volume, 0),\r\n    appointmentsTotal: kpiMetrics.appointmentVolume.reduce((sum, point) => sum + point.appointments, 0),\r\n  }\r\n\r\n  return {\r\n    hospitals: hospitals.length ? hospitals : [{ id: 0, name: \"Network Wide\", city: \"Canada\" }],\r\n    kpiMetrics,\r\n    summary,\r\n  }\r\n}\r\n\r\nexport type DepartmentInfo = {\r\n  id: number\r\n  name: string\r\n  hospital: string\r\n  staffCount: number\r\n}\r\n\r\nexport type DepartmentPatient = {\r\n  id: number\r\n  name: string\r\n  admitted: string\r\n  condition: string\r\n  status: \"Stable\" | \"Recovery\" | \"Monitoring\"\r\n}\r\n\r\nexport type AppointmentCard = {\r\n  patientName: string\r\n  type: string\r\n  date: string\r\n  room: string\r\n}\r\n\r\nexport type FollowUpCard = {\r\n  patientName: string\r\n  followUp: string\r\n  reason: string\r\n}\r\n\r\nexport type AlertCard = {\r\n  patientName: string\r\n  alert: string\r\n  severity: \"critical\" | \"warning\" | \"info\"\r\n  time: string\r\n}\r\n\r\nexport type MetricBlock = {\r\n  metric: string\r\n  value: string\r\n  status: \"Normal\" | \"Review\"\r\n}\r\n\r\nexport type ClinicalStaffDashboardData = {\r\n  departments: DepartmentInfo[]\r\n  patientsByDepartment: Record<number, DepartmentPatient[]>\r\n  appointmentsByDepartment: Record<number, AppointmentCard[]>\r\n  followUpsByDepartment: Record<number, FollowUpCard[]>\r\n  alertsByDepartment: Record<number, AlertCard[]>\r\n  metricsByPatient: Record<number, MetricBlock[]>\r\n}\r\n\r\nconst statusLabel = (value: string): DepartmentPatient[\"status\"] => {\r\n  const normalized = value.toLowerCase()\r\n  if (normalized.includes(\"resolve\")) return \"Stable\"\r\n  if (normalized.includes(\"chronic\")) return \"Recovery\"\r\n  return \"Monitoring\"\r\n}\r\n\r\nconst metricStatus = (label: string, value: number): MetricBlock[\"status\"] => {\r\n  if (label === \"Heart Rate\") {\r\n    return value >= 60 && value <= 100 ? \"Normal\" : \"Review\"\r\n  }\r\n  if (label === \"Temperature\") {\r\n    return value >= 36 && value <= 37.5 ? \"Normal\" : \"Review\"\r\n  }\r\n  return \"Normal\"\r\n}\r\n\r\nexport async function getClinicalStaffDashboardData(): Promise<ClinicalStaffDashboardData> {\r\n  const [\r\n    clinics,\r\n    staff,\r\n    doctors,\r\n    appointments,\r\n    patients,\r\n    history,\r\n    vitals,\r\n    helpTickets,\r\n  ] = await Promise.all([\r\n    fetchTable<ClinicRecord>(\"clinic_servicehistory\"),\r\n    fetchTable<{ clinic_id: number }>(\"clinical_staff_registration\"),\r\n    fetchTable<DoctorRecord>(\"doctors_registration\"),\r\n    fetchTable<AppointmentRecord>(\"appointments\"),\r\n    fetchTable<PatientRecord>(\"patients_registration\"),\r\n    fetchTable<MedicalHistoryRecord>(\"medical_history\"),\r\n    fetchTable<VitalRecord>(\"vitals_history\"),\r\n    fetchTable<ClinicHelpRecord>(\"clinic_help\"),\r\n  ])\r\n\r\n  const staffCounts = staff.reduce<Record<number, number>>((acc, entry) => {\r\n    if (!entry.clinic_id) return acc\r\n    acc[entry.clinic_id] = (acc[entry.clinic_id] ?? 0) + 1\r\n    return acc\r\n  }, {})\r\n\r\n  const activeClinics = clinics.filter((clinic) => clinic.active)\r\n  const departments = (activeClinics.length ? activeClinics : clinics).slice(0, 3).map((clinic) => ({\r\n    id: clinic.clinic_id,\r\n    name: clinic.clinic_name ?? `Clinic ${clinic.clinic_id}`,\r\n    hospital: clinic.location ?? \"Regional\",\r\n    staffCount: staffCounts[clinic.clinic_id] ?? 0,\r\n  }))\r\n\r\n  const doctorClinicMap = doctors.reduce<Record<number, number>>((acc, doctor) => {\r\n    if (doctor.doctor_id && doctor.clinic_id) {\r\n      acc[doctor.doctor_id] = doctor.clinic_id\r\n    }\r\n    return acc\r\n  }, {})\r\n\r\n  const patientMap = patients.reduce<Record<number, PatientRecord>>((acc, patient) => {\r\n    acc[patient.patient_id] = patient\r\n    return acc\r\n  }, {})\r\n\r\n  const historyMap = history.reduce<Record<number, MedicalHistoryRecord>>((acc, entry) => {\r\n    acc[entry.patient_id] = entry\r\n    return acc\r\n  }, {})\r\n\r\n  const patientsByDepartment: Record<number, DepartmentPatient[]> = {}\r\n  const appointmentsByDepartment: Record<number, AppointmentCard[]> = {}\r\n  const followUpsByDepartment: Record<number, FollowUpCard[]> = {}\r\n  const alertsByDepartment: Record<number, AlertCard[]> = {}\r\n  const metricsByPatient: Record<number, MetricBlock[]> = {}\r\n\r\n  const vitalsByPatient = vitals.reduce<Record<number, VitalRecord[]>>((acc, entry) => {\r\n    if (!entry.patient_id) return acc\r\n    acc[entry.patient_id] = acc[entry.patient_id] ?? []\r\n    acc[entry.patient_id].push(entry)\r\n    return acc\r\n  }, {})\r\n\r\n  departments.forEach((dept) => {\r\n    patientsByDepartment[dept.id] = []\r\n    appointmentsByDepartment[dept.id] = []\r\n    followUpsByDepartment[dept.id] = []\r\n    alertsByDepartment[dept.id] = []\r\n  })\r\n\r\n  const deptRoom = (clinicId: number) => {\r\n    const clinic = clinics.find((c) => c.clinic_id === clinicId)\r\n    return clinic ? `${clinic.clinic_name} Wing` : \"Care Suite\"\r\n  }\r\n\r\n  appointments.forEach((appointment) => {\r\n    const clinicId = doctorClinicMap[appointment.doctor_id]\r\n    if (!clinicId || !patientsByDepartment[clinicId]) return\r\n    const details = patientMap[appointment.patient_id]\r\n    if (!details) return\r\n\r\n    const patientList = patientsByDepartment[clinicId]\r\n    if (!patientList.find((p) => p.id === appointment.patient_id)) {\r\n      const medical = historyMap[appointment.patient_id]\r\n      patientList.push({\r\n        id: appointment.patient_id,\r\n        name: details.name,\r\n        admitted: formatShortDate(toDate(appointment.datetime) ?? new Date()),\r\n        condition: medical?.condition ?? \"General Care\",\r\n        status: medical ? statusLabel(medical.status) : \"Monitoring\",\r\n      })\r\n    }\r\n\r\n    const isFuture = (() => {\r\n      const date = toDate(appointment.datetime)\r\n      return date ? date.getTime() >= Date.now() : false\r\n    })()\r\n\r\n    if (isFuture && appointmentsByDepartment[clinicId].length < 3) {\r\n      appointmentsByDepartment[clinicId].push({\r\n        patientName: details.name,\r\n        type: appointment.status,\r\n        date: formatDateTime(toDate(appointment.datetime) ?? new Date()),\r\n        room: deptRoom(clinicId),\r\n      })\r\n    }\r\n  })\r\n\r\n  departments.forEach((dept) => {\r\n    const followUps = history.filter(\r\n      (record) =>\r\n        record.followup_required &&\r\n        patientsByDepartment[dept.id].some((patient) => patient.id === record.patient_id),\r\n    )\r\n\r\n    followUpsByDepartment[dept.id] = followUps.slice(0, 3).map((record) => ({\r\n      patientName: patientMap[record.patient_id]?.name ?? `Patient ${record.patient_id}`,\r\n      followUp: record.diagnosis_date ? formatShortDate(new Date(record.diagnosis_date)) : \"Pending\",\r\n      reason: `${record.condition} • ${record.severity ?? \"Review\"}`,\r\n    }))\r\n\r\n    const deptTickets = helpTickets.filter((ticket) => ticket.clinic_id === dept.id).slice(0, 3)\r\n    alertsByDepartment[dept.id] = (deptTickets.length ? deptTickets : helpTickets.slice(0, 3)).map(\r\n      (ticket, index) => ({\r\n        patientName: ticket.submitted_by,\r\n        alert: ticket.issue_description,\r\n        severity: ticket.issue_description.toLowerCase().includes(\"emergency\")\r\n          ? \"critical\"\r\n          : index === 0\r\n            ? \"warning\"\r\n            : \"info\",\r\n        time: `${15 * (index + 1)} min ago`,\r\n      }),\r\n    )\r\n  })\r\n\r\n  Object.entries(vitalsByPatient).forEach(([patientId, records]) => {\r\n    const latest = records.sort(\r\n      (a, b) => (toDate(b.recorded_on)?.getTime() ?? 0) - (toDate(a.recorded_on)?.getTime() ?? 0),\r\n    )[0]\r\n    if (!latest) return\r\n\r\n    const metrics: MetricBlock[] = []\r\n    if (latest.blood_pressure) {\r\n      metrics.push({\r\n        metric: \"Blood Pressure\",\r\n        value: latest.blood_pressure,\r\n        status: \"Normal\",\r\n      })\r\n    }\r\n    if (typeof latest.heart_rate === \"number\") {\r\n      metrics.push({\r\n        metric: \"Heart Rate\",\r\n        value: `${latest.heart_rate} bpm`,\r\n        status: metricStatus(\"Heart Rate\", latest.heart_rate),\r\n      })\r\n    }\r\n    if (typeof latest.temperature === \"number\") {\r\n      metrics.push({\r\n        metric: \"Temperature\",\r\n        value: `${latest.temperature.toFixed(1)}°C`,\r\n        status: metricStatus(\"Temperature\", latest.temperature),\r\n      })\r\n    }\r\n    if (typeof latest.respiratory_rate === \"number\") {\r\n      metrics.push({\r\n        metric: \"Respiratory Rate\",\r\n        value: `${latest.respiratory_rate} rpm`,\r\n        status: \"Normal\",\r\n      })\r\n    }\r\n\r\n    metricsByPatient[Number(patientId)] = metrics.length\r\n      ? metrics\r\n      : [\r\n          {\r\n            metric: \"No vitals available\",\r\n            value: \"Awaiting data\",\r\n            status: \"Review\",\r\n          },\r\n        ]\r\n  })\r\n\r\n  return {\r\n    departments,\r\n    patientsByDepartment,\r\n    appointmentsByDepartment,\r\n    followUpsByDepartment,\r\n    alertsByDepartment,\r\n    metricsByPatient,\r\n  }\r\n}\r\n\r\nexport type DoctorPatientCard = {\r\n  id: number\r\n  name: string\r\n  age: number\r\n  lastVisit: string\r\n}\r\n\r\nexport type VitalTrendPoint = {\r\n  date: string\r\n  systolic: number\r\n  diastolic: number\r\n  heartRate: number\r\n}\r\n\r\nexport type DoctorPrescriptionCard = {\r\n  drug: string\r\n  dose: string\r\n  frequency: string\r\n  since: string\r\n}\r\n\r\nexport type DoctorAppointmentCard = {\r\n  patientName: string\r\n  date: string\r\n  type: string\r\n}\r\n\r\nexport type DoctorAlert = {\r\n  message: string\r\n  tone: \"warning\" | \"info\"\r\n}\r\n\r\nexport type DoctorDashboardData = {\r\n  doctorName: string\r\n  patients: DoctorPatientCard[]\r\n  vitalsByPatient: Record<number, VitalTrendPoint[]>\r\n  currentPrescriptions: DoctorPrescriptionCard[]\r\n  previousPrescriptions: DoctorPrescriptionCard[]\r\n  upcomingAppointments: DoctorAppointmentCard[]\r\n  alerts: DoctorAlert[]\r\n}\r\n\r\nconst parseBloodPressure = (value: string | null) => {\r\n  if (!value) return null\r\n  const [systolic, diastolic] = value.split(\"/\").map((part) => Number(part))\r\n  if (Number.isNaN(systolic) || Number.isNaN(diastolic)) return null\r\n  return { systolic, diastolic }\r\n}\r\n\r\nconst calculateAge = (dob?: string | null) => {\r\n  if (!dob) return 0\r\n  const birth = new Date(dob)\r\n  if (Number.isNaN(birth.getTime())) return 0\r\n  const diff = Date.now() - birth.getTime()\r\n  return Math.max(0, Math.floor(diff / (365.25 * 24 * 60 * 60 * 1000)))\r\n}\r\n\r\nexport async function getDoctorDashboardData(doctorId = 1): Promise<DoctorDashboardData> {\r\n  const [doctors, appointments, patients, vitals, prescriptions, tasks] = await Promise.all([\r\n    fetchTable<DoctorRecord>(\"doctors_registration\"),\r\n    fetchTable<AppointmentRecord>(\"appointments\"),\r\n    fetchTable<PatientRecord>(\"patients_registration\"),\r\n    fetchTable<VitalRecord>(\"vitals_history\"),\r\n    fetchTable<PrescriptionRecord>(\"prescription\"),\r\n    fetchTable<DoctorTaskRecord>(\"doctor_tasks\"),\r\n  ])\r\n\r\n  const doctor = doctors.find((entry) => entry.doctor_id === doctorId)\r\n  const doctorAppointments = appointments.filter((apt) => apt.doctor_id === doctorId)\r\n\r\n  const patientMap = patients.reduce<Record<number, PatientRecord>>((acc, patient) => {\r\n    acc[patient.patient_id] = patient\r\n    return acc\r\n  }, {})\r\n\r\n  const patientsCards: DoctorPatientCard[] = []\r\n  const patientIds = new Set<number>()\r\n  doctorAppointments.forEach((apt) => {\r\n    if (patientIds.has(apt.patient_id)) return\r\n    patientIds.add(apt.patient_id)\r\n    const patient = patientMap[apt.patient_id]\r\n    if (!patient) return\r\n    const lastVisitDate =\r\n      doctorAppointments\r\n        .filter((entry) => entry.patient_id === apt.patient_id)\r\n        .map((entry) => toDate(entry.datetime)?.getTime() ?? 0)\r\n        .sort((a, b) => b - a)[0] ?? Date.now()\r\n    patientsCards.push({\r\n      id: patient.patient_id,\r\n      name: patient.name,\r\n      age: calculateAge(patient.dob),\r\n      lastVisit: formatShortDate(new Date(lastVisitDate)),\r\n    })\r\n  })\r\n\r\n  const vitalsByPatient = doctorAppointments.reduce<Record<number, VitalTrendPoint[]>>((acc, apt) => {\r\n    const patientVitals = vitals\r\n      .filter((record) => record.patient_id === apt.patient_id && record.blood_pressure)\r\n      .sort(\r\n        (a, b) => (toDate(a.recorded_on)?.getTime() ?? 0) - (toDate(b.recorded_on)?.getTime() ?? 0),\r\n      )\r\n      .slice(-7)\r\n      .map((record) => {\r\n        const bp = parseBloodPressure(record.blood_pressure)\r\n        return {\r\n          date: formatShortDate(toDate(record.recorded_on) ?? new Date()),\r\n          systolic: bp?.systolic ?? 0,\r\n          diastolic: bp?.diastolic ?? 0,\r\n          heartRate: record.heart_rate ?? 0,\r\n        }\r\n      })\r\n    if (patientVitals.length) {\r\n      acc[apt.patient_id] = patientVitals\r\n    }\r\n    return acc\r\n  }, {})\r\n\r\n  const currentPrescriptions = prescriptions\r\n    .filter((rx) => rx.doctor_id === doctorId && rx.status?.toLowerCase() === \"active\")\r\n    .map((rx) => ({\r\n      drug: rx.medicine_name,\r\n      dose: rx.dosage ?? \"As directed\",\r\n      frequency: rx.dosage ?? \"Per instructions\",\r\n      since: rx.start_date ? formatShortDate(new Date(rx.start_date)) : \"Ongoing\",\r\n    }))\r\n\r\n  const previousPrescriptions = prescriptions\r\n    .filter((rx) => rx.doctor_id === doctorId && rx.status?.toLowerCase() !== \"active\")\r\n    .map((rx) => ({\r\n      drug: rx.medicine_name,\r\n      dose: rx.dosage ?? \"As directed\",\r\n      frequency: rx.dosage ?? \"Per instructions\",\r\n      since: rx.end_date ? formatShortDate(new Date(rx.end_date)) : \"Completed\",\r\n    }))\r\n\r\n  const upcomingAppointments = doctorAppointments\r\n    .filter((apt) => {\r\n      const date = toDate(apt.datetime)\r\n      return date ? date.getTime() >= Date.now() && apt.status?.toLowerCase() === \"scheduled\" : false\r\n    })\r\n    .slice(0, 3)\r\n    .map((apt) => ({\r\n      patientName: patientMap[apt.patient_id]?.name ?? `Patient ${apt.patient_id}`,\r\n      date: formatDateTime(toDate(apt.datetime) ?? new Date()),\r\n      type: apt.status,\r\n    }))\r\n\r\n  const doctorAlerts: DoctorAlert[] = tasks\r\n    .filter((task) => task.doctor_id === doctorId)\r\n    .slice(0, 2)\r\n    .map((task) => ({\r\n      message: task.description,\r\n      tone: task.status.toLowerCase() === \"in progress\" ? \"warning\" : \"info\",\r\n    }))\r\n\r\n  return {\r\n    doctorName: doctor?.name ?? `Doctor ${doctorId}`,\r\n    patients: patientsCards.slice(0, 3),\r\n    vitalsByPatient,\r\n    currentPrescriptions,\r\n    previousPrescriptions,\r\n    upcomingAppointments,\r\n    alerts: doctorAlerts.length\r\n      ? doctorAlerts\r\n      : [\r\n          { message: \"No outstanding physician tasks\", tone: \"info\" },\r\n          { message: \"All lab reviews completed\", tone: \"warning\" },\r\n        ],\r\n  }\r\n}\r\n\r\nexport type PatientAppointmentCard = {\r\n  doctor: string\r\n  date: string\r\n  location: string\r\n}\r\n\r\nexport type PatientHealthPoint = {\r\n  date: string\r\n  bloodPressure: number\r\n  heartRate: number\r\n  glucose: number\r\n}\r\n\r\nexport type PatientMedication = {\r\n  name: string\r\n  dosage: string\r\n}\r\n\r\nexport type PatientRecordEntry = {\r\n  type: string\r\n  description: string\r\n  date: string\r\n  status: string\r\n  statusTone: \"success\" | \"warning\"\r\n}\r\n\r\nexport type PatientTask = {\r\n  title: string\r\n  createdDate: string\r\n}\r\n\r\nexport type PatientDashboardData = {\r\n  patientName: string\r\n  appointments: PatientAppointmentCard[]\r\n  healthMetrics: PatientHealthPoint[]\r\n  medications: PatientMedication[]\r\n  medicalRecords: PatientRecordEntry[]\r\n  tasks: PatientTask[]\r\n}\r\n\r\nexport async function getPatientDashboardData(patientId = 1): Promise<PatientDashboardData> {\r\n  const [\r\n    patients,\r\n    appointments,\r\n    doctors,\r\n    clinics,\r\n    vitals,\r\n    bloodTests,\r\n    prescriptions,\r\n    labTests,\r\n    messageHubs,\r\n  ] = await Promise.all([\r\n    fetchTable<PatientRecord>(\"patients_registration\"),\r\n    fetchTable<AppointmentRecord>(\"appointments\"),\r\n    fetchTable<DoctorRecord>(\"doctors_registration\"),\r\n    fetchTable<ClinicRecord>(\"clinic_servicehistory\"),\r\n    fetchTable<VitalRecord>(\"vitals_history\"),\r\n    fetchTable<BloodTestRecord>(\"bloodtests\"),\r\n    fetchTable<PrescriptionRecord>(\"prescription\"),\r\n    fetchTable<LabTestRecord>(\"lab_tests\"),\r\n    fetchTable<PatientMessageHubRecord>(\"patient_message_hub\"),\r\n  ])\r\n\r\n  const patient = patients.find((entry) => entry.patient_id === patientId)\r\n  const doctorMap = doctors.reduce<Record<number, DoctorRecord>>((acc, doc) => {\r\n    acc[doc.doctor_id] = doc\r\n    return acc\r\n  }, {})\r\n  const clinicMap = clinics.reduce<Record<number, ClinicRecord>>((acc, clinic) => {\r\n    acc[clinic.clinic_id] = clinic\r\n    return acc\r\n  }, {})\r\n\r\n  const patientAppointments = appointments\r\n    .filter((apt) => apt.patient_id === patientId && apt.datetime)\r\n    .slice(0, 3)\r\n    .map((apt) => {\r\n      const doctor = doctorMap[apt.doctor_id]\r\n      const location = clinicMap[doctor?.clinic_id ?? 0]?.clinic_name ?? \"Virtual Visit\"\r\n      return {\r\n        doctor: doctor?.name ?? `Doctor ${apt.doctor_id}`,\r\n        date: formatDateTime(toDate(apt.datetime) ?? new Date()),\r\n        location,\r\n      }\r\n    })\r\n\r\n  const patientVitals = vitals\r\n    .filter((record) => record.patient_id === patientId)\r\n    .sort(\r\n      (a, b) => (toDate(a.recorded_on)?.getTime() ?? 0) - (toDate(b.recorded_on)?.getTime() ?? 0),\r\n    )\r\n    .slice(-7)\r\n\r\n  const patientGlucose = bloodTests\r\n    .filter((record) => record.patient_id === patientId && record.test_name.toLowerCase().includes(\"glucose\"))\r\n    .sort((a, b) => new Date(a.test_date).getTime() - new Date(b.test_date).getTime())\r\n    .slice(-7)\r\n\r\n  const healthMetrics: PatientHealthPoint[] =\r\n    patientVitals.length > 0\r\n      ? patientVitals.map((record, index) => {\r\n          const bp = parseBloodPressure(record.blood_pressure)\r\n          const glucose = patientGlucose[index]?.result_value\r\n          return {\r\n            date: formatShortDate(toDate(record.recorded_on) ?? new Date()),\r\n            bloodPressure: bp?.systolic ?? 0,\r\n            heartRate: record.heart_rate ?? 0,\r\n            glucose: glucose ? Number(glucose) : 0,\r\n          }\r\n        })\r\n      : [\r\n          // Minimal mock data when vitals are unavailable to keep the chart visible.\r\n          { date: \"Mon\", bloodPressure: 120, heartRate: 72, glucose: 95 },\r\n          { date: \"Tue\", bloodPressure: 118, heartRate: 70, glucose: 96 },\r\n          { date: \"Wed\", bloodPressure: 122, heartRate: 74, glucose: 98 },\r\n          { date: \"Thu\", bloodPressure: 119, heartRate: 71, glucose: 97 },\r\n          { date: \"Fri\", bloodPressure: 121, heartRate: 73, glucose: 99 },\r\n          { date: \"Sat\", bloodPressure: 117, heartRate: 69, glucose: 94 },\r\n          { date: \"Sun\", bloodPressure: 120, heartRate: 72, glucose: 95 },\r\n        ]\r\n\r\n  const medications = prescriptions\r\n    .filter((rx) => rx.patient_id === patientId && rx.status?.toLowerCase() === \"active\")\r\n    .map((rx) => ({\r\n      name: rx.medicine_name,\r\n      dosage: rx.dosage ?? \"Per instructions\",\r\n    }))\r\n\r\n  const medicalRecords = labTests\r\n    .filter((record) => record.patient_id === patientId)\r\n    .slice(0, 3)\r\n    .map((record) => ({\r\n      type: record.test_type,\r\n      description: `${record.test_type} • ${record.result}`,\r\n      date: formatShortDate(new Date(record.test_date)),\r\n      status: record.status,\r\n      statusTone: record.status.toLowerCase() === \"completed\" ? (\"success\" as const) : (\"warning\" as const),\r\n    }))\r\n\r\n  const tasks = messageHubs\r\n    .filter((hub) => hub.patient_id === patientId)\r\n    .slice(0, 2)\r\n    .map((hub) => ({\r\n      title: hub.summary,\r\n      createdDate: formatDateTime(new Date(hub.last_updated)),\r\n    }))\r\n\r\n  return {\r\n    patientName: patient?.name ?? `Patient ${patientId}`,\r\n    appointments: patientAppointments,\r\n    healthMetrics,\r\n    medications: medications.length\r\n      ? medications\r\n      : [{ name: \"Medication list empty\", dosage: \"Awaiting prescriptions\" }],\r\n    medicalRecords,\r\n    tasks: tasks.length\r\n      ? tasks\r\n      : [\r\n          {\r\n            title: \"No pending tasks\",\r\n            createdDate: formatDateTime(new Date()),\r\n          },\r\n        ],\r\n  }\r\n}\r\n\r\n\r\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/doctor.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/doctor.tsx\",\n    \"default\",\n);\n","import DoctorPage from \"@/app/doctor\"\r\nimport { getDoctorDashboardData } from \"@/lib/dashboard-data\"\r\n\r\nexport const dynamic = \"force-dynamic\"\r\n\r\nexport default async function DoctorRoute() {\r\n  const data = await getDoctorDashboardData()\r\n  return <DoctorPage {...data} />\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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","ignoreList":[1]}